

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nmdc_ms_metadata_gen.lcms_metadata_generator &mdash; nmdc_mass_spectrometry_metadata_generation 3/1/2025 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=1e0eaa87"></script>
      <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            nmdc_mass_spectrometry_metadata_generation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html">Bio Ontology API Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#biosample-metadata-parser-base-class">Biosample Metadata Parser Base Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#biosample-generator-class">Biosample Generator Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#metadata-generator-base-class">Metadata Generator Base Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#metadata-workflow-generator-base-class">Metadata Workflow Generator Base Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#material-processing-metadata-generator-base-class">Material Processing Metadata Generator Base Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#lc-ms-metadata-generator-base-class">LC/MS Metadata Generator Base Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#data-class">Data Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#lc-ms-lipidomics-metadata-generator-subclass">LC/MS Lipidomics Metadata Generator Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#lc-ms-metabolomics-metadata-generator-subclass">LC/MS Metabolomics Metadata Generator Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#gc-ms-metabolomics-metadata-generator-subclass">GC/MS Metabolomics Metadata Generator Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#direct-infusion-nom-metadata-generator-subclass">Direct Infusion NOM Metadata Generator Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#lc-nom-metadata-generator-subclass">LC NOM Metadata Generator Subclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#validate-yaml-outline-function">Validate YAML Outline Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#change-sheet-generator">Change Sheet Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#workflow-sheet-generator">Workflow Sheet Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#id-pool">ID Pool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../functions.html#main-cli-class">Main CLI Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">nmdc_mass_spectrometry_metadata_generation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">nmdc_ms_metadata_gen.lcms_metadata_generator</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for nmdc_ms_metadata_gen.lcms_metadata_generator</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">nmdc_schema.nmdc</span> <span class="k">as</span> <span class="nn">nmdc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span> <span class="nn">nmdc_api_utilities.data_object_search</span> <span class="kn">import</span> <span class="n">DataObjectSearch</span>
<span class="kn">from</span> <span class="nn">nmdc_api_utilities.workflow_execution_search</span> <span class="kn">import</span> <span class="n">WorkflowExecutionSearch</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span> <span class="nn">nmdc_ms_metadata_gen.data_classes</span> <span class="kn">import</span> <span class="n">LCMSLipidWorkflowMetadata</span><span class="p">,</span> <span class="n">NmdcTypes</span>
<span class="kn">from</span> <span class="nn">nmdc_ms_metadata_gen.metadata_generator</span> <span class="kn">import</span> <span class="n">NMDCWorkflowMetadataGenerator</span>

<span class="n">load_dotenv</span><span class="p">()</span>
<span class="n">ENV</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;NMDC_ENV&quot;</span><span class="p">,</span> <span class="s2">&quot;prod&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="LCMSMetadataGenerator">
<a class="viewcode-back" href="../../functions.html#nmdc_ms_metadata_gen.lcms_metadata_generator.LCMSMetadataGenerator">[docs]</a>
<span class="k">class</span> <span class="nc">LCMSMetadataGenerator</span><span class="p">(</span><span class="n">NMDCWorkflowMetadataGenerator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for generating NMDC metadata objects using provided metadata files and configuration</span>
<span class="sd">    for LC-MS data.</span>

<span class="sd">    This class processes input metadata files, generates various NMDC objects, and produces</span>
<span class="sd">    a database dump in JSON format.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    metadata_file : str</span>
<span class="sd">        Path to the input CSV metadata file.</span>
<span class="sd">    database_dump_json_path : str</span>
<span class="sd">        Path where the output database dump JSON file will be saved.</span>
<span class="sd">    raw_data_url : str</span>
<span class="sd">        Base URL for the raw data files.</span>
<span class="sd">    process_data_url : str</span>
<span class="sd">        Base URL for the processed data files.</span>
<span class="sd">    minting_config_creds : str, optional</span>
<span class="sd">        Path to the configuration file containing the client ID and client secret for minting NMDC IDs.</span>
<span class="sd">    test : bool, optional</span>
<span class="sd">        Flag indicating whether to run in test mode. If True, will skip biosample ID checks in the database, data object URL check, and will use local IDs (skip API minting). Default is False.</span>
<span class="sd">    skip_sample_id_check : bool, optional</span>
<span class="sd">        Flag to skip sample ID checking in MongoDB. If True, will skip biosample and</span>
<span class="sd">        processed sample ID checks even in production mode. Default is False.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">metadata_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database_dump_json_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">raw_data_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">process_data_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">skip_sample_id_check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">metadata_file</span><span class="o">=</span><span class="n">metadata_file</span><span class="p">,</span>
            <span class="n">database_dump_json_path</span><span class="o">=</span><span class="n">database_dump_json_path</span><span class="p">,</span>
            <span class="n">raw_data_url</span><span class="o">=</span><span class="n">raw_data_url</span><span class="p">,</span>
            <span class="n">process_data_url</span><span class="o">=</span><span class="n">process_data_url</span><span class="p">,</span>
            <span class="n">test</span><span class="o">=</span><span class="n">test</span><span class="p">,</span>
            <span class="n">skip_sample_id_check</span><span class="o">=</span><span class="n">skip_sample_id_check</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>

<div class="viewcode-block" id="LCMSMetadataGenerator.run">
<a class="viewcode-back" href="../../functions.html#nmdc_ms_metadata_gen.lcms_metadata_generator.LCMSMetadataGenerator.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nmdc</span><span class="o">.</span><span class="n">Database</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute the metadata generation process for lipidomics data.</span>

<span class="sd">        This method performs the following steps:</span>
<span class="sd">        1. Initialize an NMDC Database instance.</span>
<span class="sd">        2. Load and process metadata to create NMDC objects.</span>
<span class="sd">        3. Generate Mass Spectrometry, Raw Data, Metabolomics Analysis, and</span>
<span class="sd">        Processed Data objects.</span>
<span class="sd">        4. Update outputs for Mass Spectrometry and Metabolomics Analysis objects.</span>
<span class="sd">        5. Append generated objects to the NMDC Database.</span>
<span class="sd">        6. Dump the NMDC Database to a JSON file.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nmdc.Database</span>
<span class="sd">            The generated NMDC database instance containing all generated metadata objects.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">            If the processed data directory is empty or not found.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of files in the processed data directory is not as expected</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method uses tqdm to display progress bars for the processing of</span>
<span class="sd">        biosamples and mass spectrometry metadata.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">(</span>
            <span class="n">config_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minting_config_creds</span>
        <span class="p">)</span>
        <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">(</span>
            <span class="n">config_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minting_config_creds</span>
        <span class="p">)</span>
        <span class="n">nmdc_database_inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_nmdc_database</span><span class="p">()</span>
        <span class="n">metadata_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_metadata</span><span class="p">()</span>

        <span class="c1"># check if manifest ids are provided or if we need to generate them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_manifest</span><span class="p">(</span>
            <span class="n">metadata_df</span><span class="o">=</span><span class="n">metadata_df</span><span class="p">,</span>
            <span class="n">nmdc_database_inst</span><span class="o">=</span><span class="n">nmdc_database_inst</span><span class="p">,</span>
            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># check if the raw data url is directly passed in or needs to be built with raw data file</span>
        <span class="n">raw_col</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;raw_data_url&quot;</span> <span class="k">if</span> <span class="s2">&quot;raw_data_url&quot;</span> <span class="ow">in</span> <span class="n">metadata_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="s2">&quot;raw_data_file&quot;</span>
        <span class="p">)</span>
        <span class="n">urls_columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_columns</span> <span class="o">+</span> <span class="p">[</span><span class="n">raw_col</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_doj_urls</span><span class="p">(</span><span class="n">metadata_df</span><span class="o">=</span><span class="n">metadata_df</span><span class="p">,</span> <span class="n">url_columns</span><span class="o">=</span><span class="n">urls_columns</span><span class="p">)</span>

        <span class="c1"># Generate mass spec fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_mass_spec_fields</span><span class="p">(</span>
            <span class="n">metadata_df</span><span class="o">=</span><span class="n">metadata_df</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">metadata_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span>
            <span class="n">total</span><span class="o">=</span><span class="n">metadata_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing LCMS samples&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">workflow_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_workflow_metadata</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">mass_spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_mass_spectrometry</span><span class="p">(</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">raw_data_file</span><span class="p">),</span>
                <span class="n">instrument_id</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">instrument_id</span><span class="p">,</span>
                <span class="n">sample_id</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sample_id&quot;</span><span class="p">],</span>
                <span class="n">raw_data_id</span><span class="o">=</span><span class="s2">&quot;nmdc:placeholder&quot;</span><span class="p">,</span>
                <span class="n">study_id</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;associated_studies&quot;</span><span class="p">]),</span>
                <span class="n">processing_institution</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processing_institution_generation</span>
                    <span class="k">if</span> <span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processing_institution_generation</span>
                    <span class="k">else</span> <span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processing_institution</span>
                <span class="p">),</span>
                <span class="n">mass_spec_configuration_id</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">mass_spec_configuration_id</span><span class="p">,</span>
                <span class="n">lc_config_id</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">lc_config_id</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">instrument_analysis_start_date</span><span class="p">,</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">instrument_analysis_end_date</span><span class="p">,</span>
                <span class="n">instrument_instance_specifier</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">instrument_instance_specifier</span><span class="p">,</span>
                <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">raw_data_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">raw_data_file</span><span class="p">),</span>
                <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data_category</span><span class="p">,</span>
                <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data_obj_type</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data_obj_desc</span><span class="p">,</span>
                <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data_url</span><span class="p">,</span>
                <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                <span class="n">was_generated_by</span><span class="o">=</span><span class="n">mass_spec</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">url</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">raw_data_url</span><span class="p">,</span>
                <span class="n">in_manifest</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">manifest_id</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Get qc fields, converting NaN to None</span>
            <span class="n">qc_status</span><span class="p">,</span> <span class="n">qc_comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_qc_fields</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Always generate metabolite_identifications (even for failed QC)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_metabolite_ids</span><span class="p">:</span>
                <span class="n">metabolite_identifications</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_metab_identifications</span><span class="p">(</span>
                    <span class="n">processed_data_dir</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metabolite_identifications</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">metab_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_metabolomics_analysis</span><span class="p">(</span>
                <span class="n">cluster_name</span><span class="o">=</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">execution_resource</span><span class="p">,</span>
                <span class="n">raw_data_name</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">raw_data_file</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">raw_data_id</span><span class="o">=</span><span class="n">raw_data_object</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">data_gen_id_list</span><span class="o">=</span><span class="p">[</span><span class="n">mass_spec</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
                <span class="n">processed_data_id</span><span class="o">=</span><span class="s2">&quot;nmdc:placeholder&quot;</span><span class="p">,</span>
                <span class="n">parameter_data_id</span><span class="o">=</span><span class="s2">&quot;nmdc:placeholder&quot;</span><span class="p">,</span>
                <span class="n">processing_institution</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processing_institution_workflow</span>
                    <span class="k">if</span> <span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processing_institution_workflow</span>
                    <span class="k">else</span> <span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processing_institution</span>
                <span class="p">),</span>
                <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                <span class="n">metabolite_identifications</span><span class="o">=</span><span class="n">metabolite_identifications</span><span class="p">,</span>
                <span class="n">qc_status</span><span class="o">=</span><span class="n">qc_status</span><span class="p">,</span>
                <span class="n">qc_comment</span><span class="o">=</span><span class="n">qc_comment</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># list all paths in the processed data directory</span>
            <span class="n">processed_data_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Add a check that the processed data directory is not empty</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">processed_data_paths</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No files found in processed data directory: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Check that there is a .csv, .hdf5, and .toml file in the processed data directory and no other files</span>
            <span class="n">processed_data_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">processed_data_paths</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_data_paths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected 3 files in the processed data directory </span><span class="si">{</span><span class="n">processed_data_paths</span><span class="si">}</span><span class="s2">, found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_data_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Always create all processed data objects</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">processed_data_paths</span><span class="p">:</span>
                <span class="n">file_type</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">suffixes</span>
                <span class="k">if</span> <span class="n">file_type</span><span class="p">:</span>
                    <span class="n">file_type</span> <span class="o">=</span> <span class="n">file_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;toml&quot;</span><span class="p">:</span>
                        <span class="c1"># Generate a data object for the parameter data</span>
                        <span class="n">processed_data_object_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                            <span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                            <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_config_process_data_category</span><span class="p">,</span>
                            <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_config_process_data_obj_type</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_config_process_data_description</span><span class="p">,</span>
                            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_data_url</span>
                            <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                            <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                            <span class="n">was_generated_by</span><span class="o">=</span><span class="n">metab_analysis</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">parameter_data_id</span> <span class="o">=</span> <span class="n">processed_data_object_config</span><span class="o">.</span><span class="n">id</span>

                    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
                        <span class="c1"># Generate a data object for the annotated data</span>
                        <span class="n">processed_data_object_annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                            <span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                            <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_config_process_data_category</span><span class="p">,</span>
                            <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_config_process_data_obj_type</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">csv_process_data_description</span><span class="p">,</span>
                            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_data_url</span>
                            <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                            <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                            <span class="n">was_generated_by</span><span class="o">=</span><span class="n">metab_analysis</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object_annot</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;hdf5&quot;</span><span class="p">:</span>
                        <span class="c1"># Generate a data object for the HDF5 processed data</span>
                        <span class="n">processed_data_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                            <span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                            <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_config_process_data_category</span><span class="p">,</span>
                            <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_process_data_obj_type</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_process_data_description</span><span class="p">,</span>
                            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_data_url</span>
                            <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
                            <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                            <span class="n">was_generated_by</span><span class="o">=</span><span class="n">metab_analysis</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                        <span class="c1"># Update MetabolomicsAnalysis times based on HDF5 file</span>
                        <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_end_times</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                        <span class="n">metab_analysis</span><span class="o">.</span><span class="n">started_at_time</span> <span class="o">=</span> <span class="n">start_time</span>
                        <span class="n">metab_analysis</span><span class="o">.</span><span class="n">ended_at_time</span> <span class="o">=</span> <span class="n">end_time</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected file type found for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># Check that all processed data objects were created</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">processed_data_object_config</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">processed_data_object_annot</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">processed_data_object</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Not all processed data objects were created for </span><span class="si">{</span><span class="n">workflow_metadata</span><span class="o">.</span><span class="n">processed_data_dir</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">has_input</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">parameter_data_id</span><span class="p">,</span>
                <span class="n">raw_data_object</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_data_objects</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">(</span>
                <span class="n">mass_spec_obj</span><span class="o">=</span><span class="n">mass_spec</span><span class="p">,</span>
                <span class="n">analysis_obj</span><span class="o">=</span><span class="n">metab_analysis</span><span class="p">,</span>
                <span class="n">raw_data_obj_id</span><span class="o">=</span><span class="n">raw_data_object</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">parameter_data_id</span><span class="o">=</span><span class="n">has_input</span><span class="p">,</span>
                <span class="n">processed_data_id_list</span><span class="o">=</span><span class="n">processed_data</span><span class="p">,</span>
                <span class="n">rerun</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># If QC status is &quot;fail&quot;, remove has_output and has_metabolite_identifications, and don&#39;t add processed data objects</span>
            <span class="k">if</span> <span class="n">qc_status</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
                <span class="n">metab_analysis</span><span class="o">.</span><span class="n">has_output</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metab_analysis</span><span class="p">,</span> <span class="s2">&quot;has_metabolite_identifications&quot;</span><span class="p">):</span>
                    <span class="n">metab_analysis</span><span class="o">.</span><span class="n">has_metabolite_identifications</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Only add processed data objects if QC passed</span>
                <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object_config</span><span class="p">)</span>
                <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object_annot</span><span class="p">)</span>
                <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object</span><span class="p">)</span>

            <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_generation_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_spec</span><span class="p">)</span>
            <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">raw_data_object</span><span class="p">)</span>
            <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">workflow_execution_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metab_analysis</span><span class="p">)</span>

            <span class="c1"># Set processed data objects to none for next iteration</span>
            <span class="p">(</span>
                <span class="n">processed_data_object_config</span><span class="p">,</span>
                <span class="n">processed_data_object_annot</span><span class="p">,</span>
                <span class="n">processed_data_object</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dump_nmdc_database</span><span class="p">(</span>
            <span class="n">nmdc_database</span><span class="o">=</span><span class="n">nmdc_database_inst</span><span class="p">,</span> <span class="n">json_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database_dump_json_path</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Metadata processing completed.&quot;</span><span class="p">)</span>
        <span class="c1"># change db object to dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmdc_db_to_dict</span><span class="p">(</span><span class="n">nmdc_database_inst</span><span class="p">)</span></div>


<div class="viewcode-block" id="LCMSMetadataGenerator.rerun">
<a class="viewcode-back" href="../../functions.html#nmdc_ms_metadata_gen.lcms_metadata_generator.LCMSMetadataGenerator.rerun">[docs]</a>
    <span class="k">def</span> <span class="nf">rerun</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">nmdc</span><span class="o">.</span><span class="n">Database</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a rerun of the metadata generation process for metabolomics data.</span>

<span class="sd">        This method performs the following steps:</span>
<span class="sd">        1. Initialize an NMDC Database instance.</span>
<span class="sd">        2. Load and process metadata to create NMDC objects.</span>
<span class="sd">        3. Generate Metabolomics Analysis and Processed Data objects.</span>
<span class="sd">        4. Update outputs for the Metabolomics Analysis object.</span>
<span class="sd">        5. Append generated objects to the NMDC Database.</span>
<span class="sd">        6. Dump the NMDC Database to a JSON file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        nmdc.Database</span>
<span class="sd">            The generated NMDC database instance containing all generated metadata objects.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FileNotFoundError</span>
<span class="sd">            If the processed data directory is empty or not found.</span>
<span class="sd">        ValueError</span>
<span class="sd">            If the number of files in the processed data directory is not as expected.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method uses tqdm to display progress bars for the processing of</span>
<span class="sd">        biosamples and mass spectrometry metadata.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">(</span>
            <span class="n">config_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minting_config_creds</span>
        <span class="p">)</span>
        <span class="n">wf_client</span> <span class="o">=</span> <span class="n">WorkflowExecutionSearch</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">ENV</span><span class="p">)</span>
        <span class="n">do_client</span> <span class="o">=</span> <span class="n">DataObjectSearch</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">ENV</span><span class="p">)</span>
        <span class="n">client_id</span><span class="p">,</span> <span class="n">client_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_credentials</span><span class="p">(</span>
            <span class="n">config_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minting_config_creds</span>
        <span class="p">)</span>
        <span class="n">nmdc_database_inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_nmdc_database</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Metadata file not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">metadata_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">:</span>
            <span class="c1"># check for duplicate doj urls in the database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_doj_urls</span><span class="p">(</span>
                <span class="n">metadata_df</span><span class="o">=</span><span class="n">metadata_df</span><span class="p">,</span> <span class="n">url_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
            <span class="n">metadata_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">(),</span>
            <span class="n">total</span><span class="o">=</span><span class="n">metadata_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Processing LCMS samples&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="c1"># workflow_metadata = self.create_workflow_metadata(data)</span>
            <span class="n">raw_data_object_id</span> <span class="o">=</span> <span class="n">do_client</span><span class="o">.</span><span class="n">get_record_by_attribute</span><span class="p">(</span>
                <span class="n">attribute_name</span><span class="o">=</span><span class="s2">&quot;url&quot;</span><span class="p">,</span>
                <span class="n">attribute_value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_data_url</span> <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;raw_data_file&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span>
                <span class="n">exact_match</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="c1"># find the MetabolomicsAnalysis object - this is the old one</span>
            <span class="n">prev_metab_analysis</span> <span class="o">=</span> <span class="n">wf_client</span><span class="o">.</span><span class="n">get_record_by_filter</span><span class="p">(</span>
                <span class="nb">filter</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">{{</span><span class="s1">&quot;has_input&quot;:&quot;</span><span class="si">{</span><span class="n">raw_data_object_id</span><span class="si">}</span><span class="s1">&quot;,&quot;type&quot;:&quot;</span><span class="si">{</span><span class="n">NmdcTypes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MetabolomicsAnalysis&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">}}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;id,uses_calibration,execution_resource,processing_institution,was_informed_by&quot;</span><span class="p">,</span>
                <span class="n">all_pages</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># find the most recent metabolomics analysis object by the max id</span>
            <span class="n">prev_metab_analysis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">prev_metab_analysis</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="c1"># increment the metab_id, find the last .digit group with a regex</span>
            <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(\d+)$&quot;</span>
            <span class="n">metab_analysis_id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
                <span class="n">regex</span><span class="p">,</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">prev_metab_analysis</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="c1"># Get qc fields, converting NaN to None</span>
            <span class="n">qc_status</span><span class="p">,</span> <span class="n">qc_comment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_qc_fields</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Always generate metabolite identifications (even for failed QC) if the method exists</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;generate_metab_identifications&quot;</span><span class="p">):</span>
                <span class="n">metabolite_identifications</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_metab_identifications</span><span class="p">(</span>
                    <span class="n">processed_data_dir</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metabolite_identifications</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">metab_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_metabolomics_analysis</span><span class="p">(</span>
                <span class="n">cluster_name</span><span class="o">=</span><span class="n">prev_metab_analysis</span><span class="p">[</span><span class="s2">&quot;execution_resource&quot;</span><span class="p">],</span>
                <span class="n">raw_data_name</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;raw_data_file&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">raw_data_id</span><span class="o">=</span><span class="n">raw_data_object_id</span><span class="p">,</span>
                <span class="n">data_gen_id_list</span><span class="o">=</span><span class="n">prev_metab_analysis</span><span class="p">[</span><span class="s2">&quot;was_informed_by&quot;</span><span class="p">],</span>
                <span class="n">processed_data_id</span><span class="o">=</span><span class="s2">&quot;nmdc:placeholder&quot;</span><span class="p">,</span>
                <span class="n">parameter_data_id</span><span class="o">=</span><span class="s2">&quot;nmdc:placeholder&quot;</span><span class="p">,</span>
                <span class="n">processing_institution</span><span class="o">=</span><span class="n">prev_metab_analysis</span><span class="p">[</span><span class="s2">&quot;processing_institution&quot;</span><span class="p">],</span>
                <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                <span class="n">incremeneted_id</span><span class="o">=</span><span class="n">metab_analysis_id</span><span class="p">,</span>
                <span class="n">metabolite_identifications</span><span class="o">=</span><span class="n">metabolite_identifications</span><span class="p">,</span>
                <span class="n">qc_status</span><span class="o">=</span><span class="n">qc_status</span><span class="p">,</span>
                <span class="n">qc_comment</span><span class="o">=</span><span class="n">qc_comment</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># list all paths in the processed data directory</span>
            <span class="n">processed_data_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">Path</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Add a check that the processed data directory is not empty</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">processed_data_paths</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No files found in processed data directory: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;processed_data_directory&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Check that there is a .csv, .hdf5, and .toml file in the processed data directory and no other files</span>
            <span class="n">processed_data_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">processed_data_paths</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">processed_data_paths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Expected 3 files in the processed data directory </span><span class="si">{</span><span class="n">processed_data_paths</span><span class="si">}</span><span class="s2">, found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_data_paths</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>

            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Always create all processed data objects</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">processed_data_paths</span><span class="p">:</span>
                <span class="n">file_type</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">suffixes</span>
                <span class="k">if</span> <span class="n">file_type</span><span class="p">:</span>
                    <span class="n">file_type</span> <span class="o">=</span> <span class="n">file_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;toml&quot;</span><span class="p">:</span>
                        <span class="c1"># Generate a data object for the parameter data</span>
                        <span class="n">processed_data_object_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                            <span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                            <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_config_process_data_category</span><span class="p">,</span>
                            <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_config_process_data_obj_type</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wf_config_process_data_description</span><span class="p">,</span>
                            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_data_url</span>
                            <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
                            <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                            <span class="n">was_generated_by</span><span class="o">=</span><span class="n">metab_analysis</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">parameter_data_id</span> <span class="o">=</span> <span class="n">processed_data_object_config</span><span class="o">.</span><span class="n">id</span>

                    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;csv&quot;</span><span class="p">:</span>
                        <span class="c1"># Generate a data object for the annotated data</span>
                        <span class="n">processed_data_object_annot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                            <span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                            <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_config_process_data_category</span><span class="p">,</span>
                            <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_config_process_data_obj_type</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">csv_process_data_description</span><span class="p">,</span>
                            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_data_url</span>
                            <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
                            <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                            <span class="n">was_generated_by</span><span class="o">=</span><span class="n">metab_analysis</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object_annot</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s2">&quot;hdf5&quot;</span><span class="p">:</span>
                        <span class="c1"># Generate a data object for the HDF5 processed data</span>
                        <span class="n">processed_data_object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_data_object</span><span class="p">(</span>
                            <span class="n">file_path</span><span class="o">=</span><span class="n">file</span><span class="p">,</span>
                            <span class="n">data_category</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_config_process_data_category</span><span class="p">,</span>
                            <span class="n">data_object_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_process_data_obj_type</span><span class="p">,</span>
                            <span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hdf5_process_data_description</span><span class="p">,</span>
                            <span class="n">base_url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">process_data_url</span>
                            <span class="o">+</span> <span class="n">Path</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span>
                            <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
                            <span class="n">CLIENT_ID</span><span class="o">=</span><span class="n">client_id</span><span class="p">,</span>
                            <span class="n">CLIENT_SECRET</span><span class="o">=</span><span class="n">client_secret</span><span class="p">,</span>
                            <span class="n">was_generated_by</span><span class="o">=</span><span class="n">metab_analysis</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

                        <span class="c1"># Update MetabolomicsAnalysis times based on HDF5 file</span>
                        <span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_end_times</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                        <span class="n">metab_analysis</span><span class="o">.</span><span class="n">started_at_time</span> <span class="o">=</span> <span class="n">start_time</span>
                        <span class="n">metab_analysis</span><span class="o">.</span><span class="n">ended_at_time</span> <span class="o">=</span> <span class="n">end_time</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected file type found for file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="c1"># Check that all processed data objects were created</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">processed_data_object_config</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">processed_data_object_annot</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="n">processed_data_object</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Not all processed data objects were created for </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;processed_data_directory&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="p">)</span>
            <span class="n">has_input</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">parameter_data_id</span><span class="p">,</span>
                <span class="n">raw_data_object_id</span><span class="p">,</span>
            <span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">existing_data_objects</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_outputs</span><span class="p">(</span>
                <span class="n">analysis_obj</span><span class="o">=</span><span class="n">metab_analysis</span><span class="p">,</span>
                <span class="n">raw_data_obj_id</span><span class="o">=</span><span class="n">raw_data_object_id</span><span class="p">,</span>
                <span class="n">parameter_data_id</span><span class="o">=</span><span class="n">has_input</span><span class="p">,</span>
                <span class="n">processed_data_id_list</span><span class="o">=</span><span class="n">processed_data</span><span class="p">,</span>
                <span class="n">rerun</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># If QC status is &quot;fail&quot;, remove has_output and has_metabolite_identifications, and don&#39;t add processed data objects</span>
            <span class="k">if</span> <span class="n">qc_status</span> <span class="o">==</span> <span class="s2">&quot;fail&quot;</span><span class="p">:</span>
                <span class="n">metab_analysis</span><span class="o">.</span><span class="n">has_output</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metab_analysis</span><span class="p">,</span> <span class="s2">&quot;has_metabolite_identifications&quot;</span><span class="p">):</span>
                    <span class="n">metab_analysis</span><span class="o">.</span><span class="n">has_metabolite_identifications</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Only add processed data objects if QC passed</span>
                <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object_config</span><span class="p">)</span>
                <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object_annot</span><span class="p">)</span>
                <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">data_object_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">processed_data_object</span><span class="p">)</span>

            <span class="n">nmdc_database_inst</span><span class="o">.</span><span class="n">workflow_execution_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metab_analysis</span><span class="p">)</span>

            <span class="c1"># Set processed data objects to none for next iteration</span>
            <span class="p">(</span>
                <span class="n">processed_data_object_config</span><span class="p">,</span>
                <span class="n">processed_data_object_annot</span><span class="p">,</span>
                <span class="n">processed_data_object</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dump_nmdc_database</span><span class="p">(</span>
            <span class="n">nmdc_database</span><span class="o">=</span><span class="n">nmdc_database_inst</span><span class="p">,</span> <span class="n">json_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database_dump_json_path</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Metadata processing completed.&quot;</span><span class="p">)</span>
        <span class="c1"># change db object to dict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nmdc_db_to_dict</span><span class="p">(</span><span class="n">nmdc_database_inst</span><span class="p">)</span></div>


<div class="viewcode-block" id="LCMSMetadataGenerator.create_workflow_metadata">
<a class="viewcode-back" href="../../functions.html#nmdc_ms_metadata_gen.lcms_metadata_generator.LCMSMetadataGenerator.create_workflow_metadata">[docs]</a>
    <span class="k">def</span> <span class="nf">create_workflow_metadata</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LCMSLipidWorkflowMetadata</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a LCMSLipidWorkflowMetadata object from a dictionary of workflow metadata.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        row : dict[str, str]</span>
<span class="sd">            Dictionary containing metadata for a workflow. This is typically</span>
<span class="sd">            a row from the input metadata CSV file.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        LCMSLipidWorkflowMetadata</span>
<span class="sd">            A LCMSLipidWorkflowMetadata object populated with data from the input dictionary.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The input dictionary is expected to contain the following keys:</span>
<span class="sd">        &#39;Processed Data Directory&#39;, &#39;Raw Data File&#39;, &#39;Raw Data Object Alt Id&#39;,</span>
<span class="sd">        &#39;mass spec configuration id&#39;, &#39;lc config id&#39;, &#39;instrument id&#39;,</span>
<span class="sd">        &#39;instrument analysis start date&#39;, &#39;instrument analysis end date&#39;,</span>
<span class="sd">        &#39;execution resource&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LCMSLipidWorkflowMetadata</span><span class="p">(</span>
            <span class="n">processed_data_dir</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;processed_data_directory&quot;</span><span class="p">],</span>
            <span class="n">raw_data_file</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;raw_data_file&quot;</span><span class="p">],</span>
            <span class="n">mass_spec_configuration_id</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;mass_spec_configuration_id&quot;</span><span class="p">],</span>
            <span class="n">lc_config_id</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;lc_config_id&quot;</span><span class="p">],</span>
            <span class="n">instrument_id</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;instrument_id&quot;</span><span class="p">],</span>
            <span class="n">instrument_analysis_start_date</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instrument_analysis_start_date&quot;</span><span class="p">),</span>
            <span class="n">instrument_analysis_end_date</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;instrument_analysis_end_date&quot;</span><span class="p">),</span>
            <span class="n">processing_institution</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;processing_institution&quot;</span><span class="p">),</span>
            <span class="n">processing_institution_generation</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;processing_institution_generation&quot;</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">processing_institution_workflow</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;processing_institution_workflow&quot;</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">),</span>
            <span class="n">execution_resource</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_resource&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">raw_data_url</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_data_url&quot;</span><span class="p">),</span>
            <span class="n">manifest_id</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manifest_id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">instrument_instance_specifier</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;instrument_instance_specifier&quot;</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Olivia Hess.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>